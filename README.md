## The Koenig Childhood Cancer Foundation (KCCF) Website

Production-ready Next.js static site for the Koenig Childhood Cancer Foundation with modern features including dark mode, cookie consent management, donation modals, and comprehensive form modal system. The site is deployed to GitHub Pages with automated CI/CD.

### Tech Stack
- **Framework**: Next.js 15 (App Router, Static Export)
- **Language**: TypeScript
- **UI**: React 19, Tailwind CSS 4
- **Linting**: ESLint 9 (Next.js config)
- **Runtime**: Node.js 20
- **Hosting**: GitHub Pages (static site)
- **Donations**: Zeffy integration (embedded iframe)
- **Forms**: Monday.com integration via modal system
- **Features**: Dark mode, cookie consent, responsive design, form modals, SEO optimization

---

## Prerequisites
- Node.js 20.x and npm 10+
- Git for version control

## Quick Start (Local Development)
```bash
# Install dependencies
npm install

# Start development server with Turbopack
npm run dev
```
Visit `http://localhost:3000`.

## Environment Variables
Create a `.env.local` file in the project root for local development (do not commit this file):
```env
# Optional: Set to 'production' to enable search engine indexing
NEXT_PUBLIC_SITE_ENV=development

# Optional: Override base path for deployment testing
NEXT_PUBLIC_BASE_PATH=

# Optional: Google Tag Manager ID (e.g., GTM-XXXXXXX)
# GTM only loads when user consents to analytics cookies
NEXT_PUBLIC_GTM_ID=
```
Notes:
- The site uses Zeffy for donations which doesn't require API keys
- Cookie consent and theme preferences are managed client-side
- All form integrations use Monday.com embedded iframes (no API keys needed)
- Google Tag Manager respects user cookie consent preferences

## Project Scripts
| Command | Description |
|---------|-------------|
| `npm run dev` | Start the dev server with Turbopack |
| `npm run build` | Production build (static export to `out/` directory) |
| `npm run start` | Start the production server locally |
| `npm run lint` | Run ESLint code quality checks |

## CI/CD Pipeline

This repository uses GitHub Actions for continuous integration and deployment:

### CI/CD Workflow (`.github/workflows/nextjs.yml`)
The main workflow runs on every push and pull request:

**On Pull Requests:**
- Lint checks (ESLint)
- TypeScript compilation check (`tsc --noEmit`)
- Production build verification

**On Push to Main:**
- All CI checks above
- Automatic deployment to GitHub Pages

### Security Scanning (`.github/workflows/codeql.yml`)
CodeQL Advanced security scanning runs:
- On every push to main
- On every pull request to main
- Weekly scheduled scans (Mondays at 1:28 AM UTC)

**Languages analyzed:**
- JavaScript/TypeScript
- GitHub Actions workflows

## Deployment

The site is automatically deployed to **GitHub Pages** when changes are pushed to the `main` branch.

### How Deployment Works
1. CI workflow runs lint, type-check, and build
2. Static site is generated in the `out/` directory
3. Artifact is uploaded to GitHub Pages
4. Site is live at `https://thekccf.org`

### Manual Deployment
You can trigger a deployment manually from the GitHub Actions tab using "workflow_dispatch".

## Docker (Development/Testing)
A Dockerfile is included for containerized development or testing:

```bash
# Build the Docker image
docker build -t kccf-web .

# Run the container
docker run -p 3000:3000 kccf-web
```
**Note:** The included Dockerfile is configured for standalone server output (e.g., running `server.js`), not for serving the static export generated by `output: 'export'` in `next.config.ts`. If you wish to containerize the static export (the contents of the `out/` directory), you will need to update the Dockerfile accordingly (e.g., use an Nginx or static file server image). Production deployment uses GitHub Pages, not Docker containers.

## Project Structure

```
KCCF-web/
├── .github/
│   └── workflows/
│       ├── codeql.yml           # CodeQL security scanning
│       └── nextjs.yml           # CI/CD pipeline (lint, build, deploy)
├── public/                      # Static assets (logos, images, favicons)
│   └── images/                  # Site images
├── src/
│   ├── app/                     # Next.js App Router pages
│   │   ├── aid/                 # Financial aid application page
│   │   ├── camp/                # Camp registration page
│   │   ├── contact/             # Contact form page
│   │   ├── crazy-socks/         # Crazy Socks campaign page
│   │   ├── donate/              # Donations page
│   │   ├── fundraisers/         # Fundraisers page
│   │   ├── kccf-family/         # KCCF family stories page
│   │   ├── media/               # Media coverage page
│   │   ├── newsletter-signup/   # Newsletter signup page
│   │   ├── our-story/           # About/KCCF story page
│   │   ├── volunteer/           # Volunteer opportunities page
│   │   ├── page.tsx             # Home page
│   │   ├── HomeContent.tsx      # Home page content component
│   │   ├── layout.tsx           # Root layout with providers
│   │   ├── globals.css          # Global styles
│   │   ├── manifest.ts          # PWA manifest
│   │   ├── robots.ts            # SEO robots.txt
│   │   ├── sitemap.ts           # SEO sitemap.xml
│   │   └── not-found.tsx        # 404 page
│   ├── components/              # Reusable UI components
│   │   ├── Navigation.tsx       # Site navigation
│   │   ├── Footer.tsx           # Site footer
│   │   ├── DonationModal.tsx    # Zeffy donation form modal
│   │   ├── FormModal.tsx        # Monday.com form modal system
│   │   ├── FormButton.tsx       # Form modal trigger buttons
│   │   ├── CookieConsentBanner.tsx # Cookie consent banner
│   │   ├── ConsentPreferencesModal.tsx # Cookie preferences modal
│   │   ├── GoogleTagManager.tsx # Google Tag Manager integration
│   │   ├── ThemeToggle.tsx      # Dark/light mode toggle
│   │   └── ...                  # Other UI components
│   ├── contexts/                # React contexts for state management
│   │   ├── ThemeContext.tsx     # Dark/light theme management
│   │   ├── CookieConsentContext.tsx # Cookie consent state
│   │   ├── DonationModalContext.tsx # Donation modal state
│   │   ├── FormModalContext.tsx # Form modal state and configurations
│   │   └── SlideshowContext.tsx # Image slideshow state
│   └── constants/               # Constant values and configurations
├── Dockerfile                   # Docker build configuration
├── next.config.ts               # Next.js configuration (static export)
├── package.json                 # Project dependencies and scripts
├── tsconfig.json                # TypeScript configuration
├── eslint.config.mjs            # ESLint configuration
├── CONTRIBUTING.md              # Contribution guidelines
├── EXTERNAL_SERVICES.md         # Guide for all external services (forms, donations, analytics)
├── SECURITY.md                  # Security policy
└── README.md                    # This file
```

## Editing Content

| Content Type | File Location |
|-------------|---------------|
| Home content | `src/app/HomeContent.tsx` |
| Page content | `src/app/<route>/page.tsx` files |
| Page metadata/SEO | `src/app/<route>/layout.tsx` files |
| Global styles | `src/app/globals.css` |
| Navigation | `src/components/Navigation.tsx` |
| Footer | `src/components/Footer.tsx` |
| Theme customization | `src/contexts/ThemeContext.tsx` |
| Cookie consent | `src/contexts/CookieConsentContext.tsx` |
| Donation modal | `src/components/DonationModal.tsx` |
| Form modals | `src/components/FormModal.tsx` and `src/contexts/FormModalContext.tsx` |

## Images and Static Assets
- Static files (logos, images, favicons) are located in `public/`
- Images are served unoptimized (required for static export to GitHub Pages)
- Image configuration is in `next.config.ts`

## Form integration

### Donation system
- The site uses Zeffy for donations via embedded iframe
- No API keys or server-side processing required
- Donation modal is controlled by `src/components/DonationModal.tsx`
- Cookie consent is required for donation form display
- Campaign-specific donation forms can be configured in the modal

### Newsletter system
The newsletter signup uses **Mailchimp** (not Zeffy). The integration is implemented as follows:

**Implementation:**
- Newsletter form is embedded via iframe from Mailchimp's list-manage.com service
- Configuration is in `src/contexts/FormModalContext.tsx` under the `newsletter-signup` form type
- The embed URL pattern is: `https://thekccf.us17.list-manage.com/subscribe?u=<user_id>&id=<list_id>`
- The newsletter button is located in the Footer component (`src/components/Footer.tsx`)

**How to verify the service being used:**
1. Open `src/contexts/FormModalContext.tsx`
2. Find the `newsletter-signup` configuration in `FORM_CONFIGS`
3. The `src` field shows the embed URL - `list-manage.com` indicates Mailchimp
4. Alternatively, open browser DevTools while viewing the newsletter modal and inspect the iframe source

**Third-party services summary:**
| Service | Purpose | URL Pattern |
|---------|---------|-------------|
| Zeffy | Donations | `zeffy.com` |
| Mailchimp | Newsletter subscriptions | `list-manage.com` |
| Monday.com | All other forms (contact, volunteer, camp, etc.) | `forms.monday.com` |
| Google Tag Manager | Analytics and tracking | `googletagmanager.com` |

### Form modal system
- Most forms are Monday.com forms integrated via a unified modal system
- Form configurations are managed in `src/contexts/FormModalContext.tsx`
- Forms include: camp registration, volunteer applications, contact forms, aid applications, and corporate sponsorship
- Newsletter signup is the exception - it uses Mailchimp instead of Monday.com
- Modal system provides consistent UX across all forms
- Cookie consent is required for form display
- Forms open in responsive modals (85% screen height) with proper scrolling

### Adding new forms
To add a new form to the modal system:

1. **Add form type** to `FormType` union in `src/contexts/FormModalContext.tsx`
2. **Add form configuration** to `FORM_CONFIGS` object with:
   - `title`: Modal header title
   - `subtitle`: Optional description
   - `src`: Form embed URL (Monday.com, Mailchimp, or other iframe-compatible service)
   - `height`: Recommended iframe height
3. **Use FormButton** component on any page:
   ```tsx
   <FormButton formType="your-new-form" variant="violet" size="lg">
     Button Text
   </FormButton>
   ```

### Form types available
- `camp-camper`: Camp registration for children (Monday.com)
- `camp-counselor`: Camp counselor applications (Monday.com)
- `crazy-socks-sponsor`: Corporate gift bag sponsorship (Monday.com)
- `newsletter-signup`: Newsletter subscription (**Mailchimp**)
- `book-elana`: Elana speaking engagements (Monday.com)
- `volunteer`: Volunteer applications (Monday.com)
- `contact`: General contact form (Monday.com)
- `aid-application`: Financial assistance applications (Monday.com)

## SEO optimization
The site is optimized for corporate partnerships and CSR programs:

### Corporate volunteering SEO
- **Target keywords**: Corporate Social Responsibility (CSR), employee volunteering, volunteer days, VTO, workplace giving programs, team-building volunteer events
- **Primary pages**: Crazy Socks (gift bag volunteering), Volunteer (corporate programs), Contact (partnerships)
- **Content strategy**: SEO-optimized paragraphs with keyword integration on key pages
- **Metadata structure**: Each page has dedicated layout.tsx files with targeted meta descriptions and keywords

### File upload configuration (Legacy - Now Modal-Based)
The aid application previously included a complex multi-step form. It's now simplified to use Monday.com forms via modal system.

### Development
- Forms are now handled via Monday.com embedded iframes in modals
- No local file handling required for most forms
- Aid applications use Monday.com form with built-in file upload capabilities

## Troubleshooting

| Issue | Solution |
|-------|----------|
| Port already in use | Stop other services using port 3000 or use a different port |
| ESLint warnings during build | `next.config.ts` allows builds to complete; run `npm run lint` locally to fix issues |
| Node version mismatch | Ensure Node 20.x is installed locally (use `node -v` to check) |
| Dark mode not working | Check `src/contexts/ThemeContext.tsx` and ensure theme toggle is properly connected |
| Cookie consent issues | Verify `src/contexts/CookieConsentContext.tsx` is properly initialized in layout |
| Donation modal not loading | Ensure marketing cookies are enabled in cookie preferences |
| Form modals not opening | Verify `FormModalProvider` is wrapped in layout and `FormModal` component is included |
| Form modal scrolling issues | Check modal height settings in `FormModal.tsx` |
| Monday.com forms not loading | Ensure marketing cookies are enabled and form URLs are correct in `FormModalContext.tsx` |
| Build fails on GitHub Actions | Check workflow logs in Actions tab; verify Node version matches (20.x) |
| GitHub Pages deployment fails | Ensure the `ci` job passes; check permissions and Pages configuration |

## Security

This repository uses GitHub's security features available for public repositories:

### Code Scanning
- **CodeQL Analysis**: Automated security scanning runs on every push and PR to main
- **Languages covered**: JavaScript/TypeScript and GitHub Actions workflows
- **Schedule**: Also runs weekly on Mondays for ongoing security monitoring

### Reporting Security Issues
If you discover a security vulnerability, please report it responsibly:
1. **Do not** create a public GitHub issue
2. Contact the maintainers directly via the contact information on [thekccf.org](https://thekccf.org/contact)
3. Allow time for the issue to be addressed before public disclosure

## Contributing

We welcome contributions! Here's how to get started:

### Getting Started
1. Fork the repository
2. Clone your fork: `git clone https://github.com/YOUR-USERNAME/KCCF-web.git`
3. Install dependencies: `npm install`
4. Create a feature branch: `git checkout -b feature/your-feature-name`
5. Make your changes
6. Run lint and build: `npm run lint && npm run build`
7. Commit your changes with descriptive messages
8. Push to your fork and create a Pull Request

### Pull Request Guidelines
- Ensure all CI checks pass (lint, type-check, build)
- Provide a clear description of your changes
- Reference any related issues
- Keep changes focused and atomic
- Follow existing code style and conventions

### Code Style
- TypeScript for all source files
- Follow the ESLint configuration
- Use descriptive variable and function names
- Add comments for complex logic

## Maintainers
- Primary owner: KCCF web team
- Repository: [koenig-childhood-cancer-foundation/KCCF-web](https://github.com/koenig-childhood-cancer-foundation/KCCF-web)

## License
All rights reserved. Content and code are the property of Koenig Childhood Cancer Foundation unless otherwise noted.
